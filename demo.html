<!DOCTYPE html>
<html>
<head>
  <title>AngularJS Paylogic Shopping Service API Demo</title>

  <script src="bower_components/angular/angular.min.js"></script>
  <script src="bower_components/angular-resource/angular-resource.min.js"></script>
  <script src="bower_components/angular-base64/angular-base64.min.js"></script>

  <script src="angular-paylogic-shopping-service.js"></script>
</head>
<body ng-app="demoApp">

  <div ng-controller="mainController">
    <div ng-show="events[0]">
      <h1>Events</h1>
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Subtitle</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="event in events">
            <td>{{event.title.en}}</td>
            <td>{{event.subtitle.en}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>


  <script type="text/javascript">
  (function() {
    "use strict";

    angular.module("demoApp", ["angular-paylogic-shopping-service"])
      .controller("mainController", function($scope, paylogicShoppingService) {

        /*
         *
         * The following example demonstrates a complete buying process.
         *
         */
        paylogicShoppingService.events.query(function(events) {

          $scope.events = events["_embedded"]["shop:event"];

          paylogicShoppingService.products.query(function(products) {

            $scope.products = products["_embedded"]["shop:product"];

            var productUri = $scope.products[0]["_links"]["self"]["href"];

            var params = {
              "products": productUri + ",2",
              "country": "NL"
            };

            paylogicShoppingService.bill.get(params, function(bill) {

              $scope.bill = bill;

              var consumer =  {
                "first_name": "John",
                "last_name": "Doe",
                "date_of_birth": "1986-12-30",
                "email": "john.doe@paylogic.eu",
                "gender": "1",
                "address": "Nieuwe Boteringestraat 28",
                "postal_code": "9716 JJ",
                "city": "Groningen",
                "country": "NL",
                "ip": "192.168.1.1"
              };

              var paymentMethodUid = $scope.bill["payment_methods"][0]["uid"];

              var shippingMethodUid = $scope.bill["shipping_methods"][0]["uid"];

              var productData = {
                "product": productUri,
                "quantity": 2
              };

              var orderParams = {
                "products": [productData],
                "consumer": consumer,
                "payment_method": paymentMethodUid,
                "shipping_method": shippingMethodUid
              };

              paylogicShoppingService.orders.create(orderParams, function(order) {

                console.log(order);

              });

            });

          });

        });

      });

  }).call(this);
  </script>
</body>
</html>
